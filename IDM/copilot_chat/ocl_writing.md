<!-- Generated by SpecStory -->

# Adding OCL constraints to SimplePDL model (2025-07-25 09:55Z)

_**User**_

Tu es un expert en OCL (Object constraint language). Tu m'aides à écrire de nouvelles contraintes pour le SimplePDL à l'aide de ceci:

```ocl
import 'SimplePDL.ecore'

package simplepdl

context Process
inv warningSeverity: false
inv withMessage('Explicit message in process ' + self.name + ' (withMessage)'): false
inv errorSeverity: null

context Process
inv validName('Invalid name: ' + self.name):
	self.name.matches('[A-Za-z_][A-Za-z0-9_]*')

context ProcessElement
def: process(): Process =
	Process.allInstances()
		->select(p | p.processElements->includes(self))
		->asSequence()->first()

context WorkSequence
inv successorAndPredecessorInSameProcess('Activities not in the same process : '
		+ self.predecessor.name + ' in ' + self.predecessor.process().name+ ' and '
		+ self.successor.name + ' in ' + self.successor.process().name
):
	self.process() = self.successor.process()
	and self.process() = self.predecessor.process()

endpackage
```

je veux ajouter 4 nouvelles contraintes: trace-moi le chemin pour y arriver.

---

_**Assistant**_

Je vais vous guider pour ajouter 4 nouvelles contraintes OCL à votre fichier SimplePDL. Voici le chemin étape par étape :

## Étape 1 : Analyser la structure existante

D'abord, examinez la structure de votre fichier `SimplePDL.ecore` pour identifier les classes et attributs disponibles. Les contraintes existantes montrent qu'il y a au moins :
- `Process` avec un attribut `name`
- `ProcessElement` 
- `WorkSequence` avec `predecessor` et `successor`

## Étape 2 : Choisir les types de contraintes à ajouter

Voici 4 types de contraintes courantes pour SimplePDL :

1. **Contrainte sur les noms uniques des activités**
2. **Contrainte sur les dépendances cycliques**
3. **Contrainte sur les ressources**
4. **Contrainte sur la cohérence des types de liens**

## Étape 3 : Implémenter les contraintes

````ocl
import 'SimplePDL.ecore'

package simplepdl

context Process
inv uniqueName('')

// ...existing code...

-- Contrainte 1 : Noms uniques des activités dans un processus
context Process
inv uniqueActivityNames('Duplicate activity names in process ' + self.name):
	self.processElements->select(oclIsTypeOf(WorkDefinition))
		->collect(oclAsType(WorkDefinition).name)->isUnique(n | n)

-- Contrainte 2 : Pas de dépendances cycliques
context WorkSequence  
inv noCyclicDependencies('Cyclic dependency detected'):
	not self.predecessor.allSuccessors()->includes(self.predecessor)

-- Contrainte 3 : Les ressources utilisées doivent être déclarées
context WorkDefinition
inv declaredResources('Undeclared resource used'):
	self.usedResources->forAll(r | 
		self.process().processElements->select(oclIsTypeOf(Resource))
			->exists(res | res.oclAsType(Resource) = r))

-- Contrainte 4 : Cohérence des types de liens de séquence
context WorkSequence
inv validLinkType('Invalid link type for sequence'):
	self.linkType = WorkSequenceType::startToStart implies 
		(self.predecessor.oclIsTypeOf(WorkDefinition) and 
		 self.successor.oclIsTypeOf(WorkDefinition))

endpackage
````

## Étape 4 : Définir les opérations auxiliaires si nécessaire

Si certaines contraintes nécessitent des opérations auxiliaires, ajoutez-les :

````ocl
-- Opération auxiliaire pour détecter les cycles
context WorkDefinition
def: allSuccessors(): Set(WorkDefinition) =
	self.outgoingSequences->collect(successor)->asSet()
		->union(self.outgoingSequences->collect(successor)
			->collect(allSuccessors())->flatten()->asSet())
````

## Étapes suivantes :

1. **Vérifiez** que les noms de classes et attributs correspondent à votre modèle Ecore
2. **Testez** chaque contrainte individuellement
3. **Adaptez** les messages d'erreur selon vos besoins
4. **Validez** avec des instances de test

Souhaitez-vous que je détaille l'une de ces contraintes ou que je propose d'autres types de contraintes spécifiques à votre domaine ?

---

